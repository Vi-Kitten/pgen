# pgen
A PEG tokenizer/parser-generator.

This is the program that generates the tokenizer and parser for the [Daisho](https://github.com/apaz-cli/Daisho)
programming language. Right now, it's a WIP.

The syntax of pgen is based on the paper ["Parsing Expression Grammars: A Recognition-Based Syntactic Foundation"](https://bford.info/pub/lang/peg.pdf)
by [Bryan Ford](https://scholar.google.com/citations?hl=en&user=TwyzQP4AAAAJ). It's bootstrapped from and
inspired by [packcc](https://github.com/arithy/packcc) by [Arihiro Yoshida](https://github.com/arithy).
It also implements some extra custom extensions for constructing ASTs
([Abstract Syntax Trees](https://en.wikipedia.org/wiki/Abstract_syntax_tree)) effortlessly, since that's
notably lacking in packcc.

## Roadmap

- [x] Working PEG grammar
- [x] PackCC extensions
- [ ] PEG AST generation
- [ ] Tokenizer pgen extensions
- [ ] AST pgen extensions
- [ ] PEG symbol tables
- [ ] Left-recursion elmimination
- [ ] Tokenizer code generataion
- [ ] Parser code generation
- [ ] Daisho grammar
- [ ] Daisho symbol tables


## Bootstrapping

First, build the latest version of [packcc](https://github.com/arithy/packcc). Name the binary `packcc`.
The code should already be included in this repo as `packcc.c`. A linux x86_64 ELF binary is also included.
Overwrite it if you're on another platform. Compiling packcc should not require any special flags. To
update/refetch and recompile packcc, it should just be:
```sh
curl https://raw.githubusercontent.com/arithy/packcc/master/src/packcc.c

cc packcc.c -o packcc
```

Once you have your `packcc` binary, you should be able to just put it in the main project folder and type:
```sh
./build
```

In order, this will:
  1. Use packcc to generate a parser for pgen grammar from a packcc grammar.
  2. Combine the `.h` and `.c` files that were generated.
  3. Compile the combined file into a bootstrap pgen version.
  4. Use the bootstrap pgen version to generate a new tokenizer and parser, this time from a grammar written in pgen itself.
  5. Compile the new tokenizer and parser into a new pgen version.
  6. Use the new pgen version to parse its own syntax and regenerate the tokenizer and parser for its own binary.
  7. Recompile using the new tokenizer and parser.

## Using pgen

Once more of the grammar and features are decided upon, this will be fleshed out. The plan is that the
syntax will be mostly `peg` syntax (as described in `PEG.pdf`), but will have its own system for building
an [Abstract Syntax Tree](https://en.wikipedia.org/wiki/Abstract_syntax_tree), and for dealing with
returns, parser state, and tokenization.


## License

The code and a binary for `packcc` are included in this repo, but are not a part of the final `pgen`
executable or code generated by `pgen`. Packcc is public domain (to the extent allowable by law). See
the main repo ([https://github.com/arithy/packcc](https://github.com/arithy/packcc)) and PPC_LICENSE for
details.

The license for `pgen` is GPLv3. The license applies only to the files already in this repository (other
than `packcc.c` and `packcc`). The license for the code generated by `pgen` is the license of the grammar
that it was generated from. For example, since the parser for `pgen` is itself generated from `pgen.peg`
which is GPLv3, the resulting `pgen.h` from running `pgen pgen.peg` is also GPLv3. If `pgen.peg` were MIT
licensed, then `pgen.h` would be MIT licensed as well. If you write a grammar, you own the code that
`pgen` generates from it. But if you modify `pgen` itself and distribute it, it has to be released under
GPLv3.

If these terms are not acceptable for you, please contact me with your use case.

