#!/bin/sh

# Clean
rm peg tmp.c PEG.c PEG.h a.out 2>/dev/null

# Run packcc
./packcc PEG.peg

# If successful, build the parser.
if test -f "PEG.c"; then

  # Combine the .c and .h files
  printf "/* PEG.h */\n" > tmp.c
  cat PEG.h >> tmp.c
  printf "\n\n/* PEG.c */\n" >> tmp.c
  cat PEG.c >> tmp.c
  grep -v "#include \"PEG.h\"" tmp.c > PEG.c
  rm PEG.h tmp.c

  # Compile
  cc -O0 -rdynamic -g PEG.c -o peg

else
  printf "\033[0;31mPackcc failed.\033[0m\n"
fi
